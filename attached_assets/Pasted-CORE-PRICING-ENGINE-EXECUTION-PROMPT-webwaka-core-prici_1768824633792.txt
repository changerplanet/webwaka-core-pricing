CORE PRICING ENGINE EXECUTION PROMPT

(webwaka-core-pricing)

‚∏ª

PLATFORM & ACCOUNT

Execution Platform: Replit
Replit Account: Replit-XX (the account you are currently using for core services)
Target Repository:
üëâ https://github.com/changerplanet/webwaka-core-pricing

IMPORTANT
	‚Ä¢	This repo already exists (scaffolded by Manus)
	‚Ä¢	Branch protection is currently disabled
	‚Ä¢	You may push directly to main
	‚Ä¢	GitHub + Vercel are already configured ‚Äî do NOT modify infra

‚∏ª

CONTEXT (READ CAREFULLY)

You are implementing Phase 3B-3: Core Pricing Engine for the WebWaka Modular Rebuild.

This is a TypeScript-only, headless core library.

It MUST conform to:
	‚Ä¢	WebWaka Ecosystem Constitution v1.3.1
	‚Ä¢	Phase 3B-2 Pricing Domain Model (LOCKED)
	‚Ä¢	Core Ledger invariants (append-only, event-driven)
	‚Ä¢	Registry + Capability system
	‚Ä¢	Nigeria-first, mobile-first, offline-aware principles

‚∏ª

ABSOLUTE SCOPE BOUNDARIES (NON-NEGOTIABLE)

‚ùå DO NOT:
	‚Ä¢	Build any UI
	‚Ä¢	Build dashboards
	‚Ä¢	Build payment logic
	‚Ä¢	Build subscription state machines
	‚Ä¢	Talk to payment gateways
	‚Ä¢	Apply discounts, coupons, taxes, or incentives
	‚Ä¢	Store balances
	‚Ä¢	Mutate historical pricing data

‚úÖ YOU MUST:
	‚Ä¢	Implement deterministic pricing evaluation
	‚Ä¢	Produce ledger-ready pricing results
	‚Ä¢	Enforce immutability and versioning
	‚Ä¢	Remain pure and side-effect free

‚∏ª

WHAT YOU ARE BUILDING

Repository

webwaka-core-pricing

Type

TypeScript library (no server, no frontend)

Purpose

Evaluate pricing plans and emit ledger-ready pricing intents.

‚∏ª

REQUIRED DOMAIN IMPLEMENTATION (EXACT)

You MUST implement exactly the following (no more, no less).

‚∏ª

1Ô∏è‚É£ Domain Models (Zod-validated)

Implement the canonical models from Phase 3B-2:
	‚Ä¢	PricingPlan
	‚Ä¢	PricingPlanVersion
	‚Ä¢	PricingComponent union:
	‚Ä¢	FlatFeeComponent
	‚Ä¢	UsageComponent
	‚Ä¢	SeatComponent
	‚Ä¢	TieredComponent
	‚Ä¢	TimeBoundComponent
	‚Ä¢	PricingContext
	‚Ä¢	PricingResult
	‚Ä¢	PricingLineItem

All models must:
	‚Ä¢	Be immutable by design
	‚Ä¢	Be validated using zod
	‚Ä¢	Reject invalid or partial inputs

‚∏ª

2Ô∏è‚É£ Pricing Engine (Core Service)

Implement:

class PricingEngine {
  evaluate(
    planVersion: PricingPlanVersion,
    context: PricingContext
  ): PricingResult
}

Rules
	‚Ä¢	Pure function
	‚Ä¢	Deterministic
	‚Ä¢	No IO
	‚Ä¢	No persistence
	‚Ä¢	Same input ‚Üí same output

‚∏ª

3Ô∏è‚É£ Ledger Compatibility (CRITICAL)

The output must be directly consumable by:

webwaka-core-ledger.recordEvent()

This means:
	‚Ä¢	Clear line items
	‚Ä¢	Explicit totals
	‚Ä¢	Currency present
	‚Ä¢	No side effects

DO NOT write to the ledger.
DO NOT import ledger code.
Just be compatible.

‚∏ª

4Ô∏è‚É£ Capabilities (module.manifest.json)

Register exactly these capabilities:

pricing:evaluate
pricing:plan.define
pricing:plan.version
pricing:preview

Declare dependencies on:
	‚Ä¢	webwaka-core-ledger
	‚Ä¢	webwaka-core-entitlements (logical, not implementation)

‚∏ª

5Ô∏è‚É£ Tests (MANDATORY)

You MUST implement tests proving:

‚úÖ Determinism
‚úÖ Immutability of plan versions
‚úÖ Correct evaluation of:
	‚Ä¢	Flat fee
	‚Ä¢	Usage pricing
	‚Ä¢	Seat pricing
	‚Ä¢	Tiered pricing
	‚Ä¢	Time-bound components
‚úÖ Tenant isolation
‚úÖ Nigeria-first defaults (NGN)

HARD STOP TEST (REQUIRED)

A test that proves:

‚ÄúGiven a PricingPlanVersion and PricingContext, the engine produces a deterministic, ledger-ready PricingResult without touching payments, subscriptions, or incentives.‚Äù

‚∏ª

6Ô∏è‚É£ Coverage Requirements
	‚Ä¢	‚â• 80% overall coverage
	‚Ä¢	All component types tested
	‚Ä¢	Edge cases included

‚∏ª

FILE STRUCTURE (EXPECTED)

src/
 ‚îú‚îÄ engine/
 ‚îÇ   ‚îî‚îÄ pricing-engine.ts
 ‚îú‚îÄ models/
 ‚îÇ   ‚îú‚îÄ pricing-plan.ts
 ‚îÇ   ‚îú‚îÄ pricing-components.ts
 ‚îÇ   ‚îî‚îÄ pricing-context.ts
 ‚îú‚îÄ evaluators/
 ‚îÇ   ‚îú‚îÄ flat.ts
 ‚îÇ   ‚îú‚îÄ usage.ts
 ‚îÇ   ‚îú‚îÄ seat.ts
 ‚îÇ   ‚îú‚îÄ tiered.ts
 ‚îÇ   ‚îî‚îÄ time.ts
 ‚îú‚îÄ types.ts
 ‚îî‚îÄ index.ts

tests/
 ‚îî‚îÄ pricing-engine.test.ts


‚∏ª

CI / TOOLING

Use existing repo setup:
	‚Ä¢	npm test
	‚Ä¢	npm run build
	‚Ä¢	npm run lint
	‚Ä¢	npm run typecheck

DO NOT change CI configuration.

‚∏ª

DELIVERY REQUIREMENTS

When complete, respond with ONLY:

‚úÖ Completion Summary including:
	‚Ä¢	What was implemented
	‚Ä¢	Test results + coverage
	‚Ä¢	Hard Stop proof explanation
	‚Ä¢	Capabilities registered
	‚Ä¢	Confirmation that scope boundaries were respected

Then:

‚õî STOP
‚õî Await authorization for Phase 3C ‚Äî Core Entitlements

‚∏ª

FINAL ACKNOWLEDGEMENT

Before coding, reply internally (not to user):

‚ÄúI understand the scope, invariants, and constraints and will implement exactly as specified.‚Äù

Then proceed.